{% extends 'base.html' %}
{% load static %}

{% block content %}
    <link href="{% static 'base/css/product.css' %}" rel="stylesheet">
    <link href="{% static 'product/addslider/addSlider.min.css' %}" rel="stylesheet">
    <link href="{% static 'base/css/font-marvenpro.css' %}" rel="stylesheet">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <section>
        {#        <div class="container">#}
        <div class="row">
            <ol class="breadcrumb">
                <li><a href="#">Home</a></li>
            </ol>
        </div>

        <div class="col-md-2 filter" id="filter">
            <h3>Filter</h3>
            <button class="btn btn-danger" id="clear_button" data-id="clear">Clear</button>

            <div>
                <hr>
            </div>

            <h3>Sex</h3>

            <div class="checkbox" id="male_sex" data-id="Men"><label><input type="checkbox">
                Men</label>
            </div>
            <div class="checkbox" id="female_sex" data-id="Women"><label><input type="checkbox">
                Women</label>
            </div>
            <div class="checkbox" id="uni_sex" data-id="Unisex"><label><input type="checkbox">
                Unisex</label>
            </div>


            <div>
                <hr>
            </div>

            <h3>Size</h3>
            <button id="size_s" data-id="S"><a href="#">S</a></button>
            <button id="size_m" data-id="M"><a href="#">M</a></button>
            <button id="size_l" data-id="L"><a href="#">L</a></button>
            <button id="size_xl" data-id="XL"><a href="#">XL</a></button>
            <button id="size_xxl" data-id="XXL"><a href="#">XXL</a></button>

            <div>
                <hr>
            </div>


            <div id="test">
                <h3>Max Price</h3>
                <br>

                <div id="slider">
                    <div id="custom-handle" class="ui-slider-handle"></div>
                </div>

            </div>

            <br><br>
            <div>
                <hr>
            </div>

            <div>
                <form id="brand_form" name="form-country_v1">
                    <div class="typeahead__container">
                        <div class="typeahead__field">

                                <span class="typeahead__query">
                                    <input class="brand-typeahead" id="brand_name" name="country_v1[query]"
                                           type="search" placeholder="Brand search" autocomplete="off">
                                </span>
                            <span class="typeahead__button">
                                    <button class="typeahead__search-icon" type="submit" data-id="search">
                                    </button>
                                </span>

                        </div>
                    </div>
                </form>
            </div>


            <div id="checklist">

            </div>

            <div>
                <hr>
            </div>

        </div>

        {# Pic and Des #}
        <div class="col-md-10 text-center" id="product-content">

            {% include 'pages/product/item/product_item.html' %}

        </div>


        {#        </div>#}

    </section>

    <script src="{% static 'product/addslider/addSlider.js' %}"></script>

    <script src="{% static 'product/addslider/Obj.min.js' %}"></script>

    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <script>
        var filtered_list = {};
        filtered_list['size'] = null;
        filtered_list['maxprice'] = null;
        filtered_list['clear'] = 'c0';
        filtered_list['search'] = 's0';
        filtered_list['sex'] = [];
        filtered_list['brand'] = [];

        $(function () {
            var handle = $("#custom-handle");

            $("#slider").slider({
                max: {{ max_price.price__max }},
                min: 0,

                create: function () {

                    handle.text($(this).slider("value"));
                },
                slide: function (event, ui) {
                    handle.text(ui.value);


                },
                stop: function (event, ui) {
                    console.log(ui.value);
                    filtered_list['maxprice'] = ui.value;
                    console.log(filtered_list);
                    $('#product-content').html("");
                    $.ajax({
                        url: "{% url 'product:filtered' %}",
                        type: 'POST',
                        traditional: true,
                        data: {data_id: JSON.stringify(filtered_list), brand: $('#brand_name').val()},

                        success: function (json) {
                            if (json.content['result']) {
                                console.log('refresd content');
                                $('#product-content').append(json.content['rendered']);
                                filtered_list['clear'] = 'c0';
                                filtered_list['search'] = 's0';
                            } else {
                                console.log('Fail to filter');
                            }
                        }
                    });


                }

            });
        });

        $('#size_s').on('click', function () {
            var element = $(this);
            console.log(filtered_list['size']);
            if (filtered_list['size'] != null)
                $('#size_' + filtered_list['size'].toLowerCase()).removeClass("btn-success");

            filtered_list['size'] = element.attr("data-id");
            element.addClass("btn-success");


            console.log(filtered_list);
        });

        $('#size_m').on('click', function () {
            var element = $(this);
            console.log(filtered_list['size']);
            if (filtered_list['size'] != null)
                $('#size_' + filtered_list['size'].toLowerCase()).removeClass("btn-success");
            filtered_list['size'] = element.attr("data-id");
            element.addClass("btn-success");


            console.log(filtered_list);
        });

        $('#size_l').on('click', function () {
            var element = $(this);
            console.log(filtered_list['size']);

            if (filtered_list['size'] != null)
                $('#size_' + filtered_list['size'].toLowerCase()).removeClass("btn-success");

            filtered_list['size'] = element.attr("data-id");
            element.addClass("btn-success");


            console.log(filtered_list);
        });

        $('#size_xl').on('click', function () {
            var element = $(this);
            console.log(filtered_list['size']);
            if (filtered_list['size'] != null)
                $('#size_' + filtered_list['size'].toLowerCase()).removeClass("btn-success");

            filtered_list['size'] = element.attr("data-id");
            element.addClass("btn-success");


            console.log(filtered_list);
        });

        $('#size_xxl').on('click', function () {
            var element = $(this);
            console.log(filtered_list['size']);
            if (filtered_list['size'] != null)
                $('#size_' + filtered_list['size'].toLowerCase()).removeClass("btn-success");

            filtered_list['size'] = element.attr("data-id");
            element.addClass("btn-success");


            console.log(filtered_list);
        });

        $('#clear_button').on('click', function () {
            if (filtered_list['size'] != null)
                $('#size_' + filtered_list['size'].toLowerCase()).removeClass("btn-success");
            filtered_list['clear'] = 'c1';
            filtered_list['maxprice'] = null;
            filtered_list['size'] = null;
            filtered_list['sex'] = [];

        });

        $('#male_sex').on('click', function () {
            var element = $(this);
            if (filtered_list['sex'].indexOf(element.attr("data-id")) != -1)
                filtered_list['sex'].splice(filtered_list['sex'].indexOf(element.attr("data-id")), 1);
            else
                filtered_list['sex'].push(element.attr("data-id"));

            console.log(filtered_list);

            $('#product-content').html("");

            $.ajax({
                url: "{% url 'product:filtered' %}",
                type: 'POST',
                traditional: true,
                data: {button_id: element.attr("data-id"), brand: $('#brand_name').val()},
                data: {data_id: JSON.stringify(filtered_list), brand: $('#brand_name').val()},

                success: function (json) {
                    if (json.content['result']) {
                        console.log('refreshed content');
                        $('#product-content').append(json.content['rendered']);
                        filtered_list['clear'] = 'c0';
                    } else {
                        console.log('Fail to filter');
                    }
                }
            });
        });

        $('#female_sex').on('click', function () {
            var element = $(this);
            if (filtered_list['sex'].indexOf(element.attr("data-id")) != -1)
                filtered_list['sex'].splice(filtered_list['sex'].indexOf(element.attr("data-id")), 1);
            else
                filtered_list['sex'].push(element.attr("data-id"));

            console.log(filtered_list);

            $('#product-content').html("");

            $.ajax({
                url: "{% url 'product:filtered' %}",
                type: 'POST',
                traditional: true,
                data: {button_id: element.attr("data-id"), brand: $('#brand_name').val()},
                data: {data_id: JSON.stringify(filtered_list), brand: $('#brand_name').val()},

                success: function (json) {
                    if (json.content['result']) {
                        console.log('refreshed content');
                        $('#product-content').append(json.content['rendered']);
                        filtered_list['clear'] = 'c0';
                    } else {
                        console.log('Fail to filter');
                    }
                }
            });
        });

        $('#uni_sex').on('click', function () {
            var element = $(this);
            if (filtered_list['sex'].indexOf(element.attr("data-id")) != -1)
                filtered_list['sex'].splice(filtered_list['sex'].indexOf(element.attr("data-id")), 1);
            else
                filtered_list['sex'].push(element.attr("data-id"));

            console.log(filtered_list);

            $('#product-content').html("");

            $.ajax({
                url: "{% url 'product:filtered' %}",
                type: 'POST',
                traditional: true,
                data: {button_id: element.attr("data-id"), brand: $('#brand_name').val()},
                data: {data_id: JSON.stringify(filtered_list), brand: $('#brand_name').val()},

                success: function (json) {
                    if (json.content['result']) {
                        console.log('refreshed content');
                        $('#product-content').append(json.content['rendered']);
                        filtered_list['clear'] = 'c0';
                    } else {
                        console.log('Fail to filter');
                    }
                }
            });

        });


        $('button').on('click', function () {
            $('#product-content').html("");
            var element = $(this);

            $.ajax({
                url: "{% url 'product:filtered' %}",
                type: 'POST',
                traditional: true,
                {#                data: {button_id: element.attr("data-id"), brand: $('#brand_name').val()},#}
                data: {data_id: JSON.stringify(filtered_list), brand: $('#brand_name').val()},

                success: function (json) {
                    if (json.content['result']) {
                        console.log('refreshed content');
                        $('#product-content').append(json.content['rendered']);
                        filtered_list['clear'] = 'c0';
                    } else {
                        console.log('Fail to filter');
                    }
                }
            });

        });


        $('#brand_form').submit(function (event) {
            filtered_list['search'] = 's1';
            console.log('Enter key press');
            $('#product-content').html("");
            var element = $(this);
            console.log(filtered_list['search']);

            $.ajax({
                url: "{% url 'product:filtered' %}",
                type: 'POST',
                data: {data_id: JSON.stringify(filtered_list), brand: $('#brand_name').val()},

                success: function (json) {
                    if (json.content['result']) {
                        console.log('refreshed content');
                        $('#product-content').append(json.content['rendered']);
                        filtered_list['clear'] = 'c0';
                        filtered_list['search'] = 's0';

                    } else {
                        console.log('Fail to filter');
                    }
                }
            });
            event.preventDefault();

        });


        var brandList = [];
        var checklist = "";


        {% for brand in brands %}
            brandList.push('{{ brand }}');
        {% endfor %}

        for (var i = 0; i < brandList.length; i++) {
            checklist += "<div class = \"checkbox\" id = \"" + i + "\" onclick = \"brandCheck(this.id)\" data-id = \"" + brandList[i] + "\"> <label> <input type = \"checkbox\" data-id = \"" + brandList[i] + "\">";
            checklist += brandList[i] + "";
            checklist += "</label> </div>";
            console.log(checklist);
        }

        function brandCheck(id) {
            var element = $('#' + id);

            if (filtered_list['brand'].indexOf(element.attr("data-id")) != -1)
                filtered_list['brand'].splice(filtered_list['brand'].indexOf(element.attr("data-id")), 1);
            else
                filtered_list['brand'].push(element.attr("data-id"));

            $('#product-content').html("");

            $.ajax({
                url: "{% url 'product:filtered' %}",
                type: 'POST',
                traditional: true,
                data: {button_id: element.attr("data-id"), brand: $('#brand_name').val()},
                data: {data_id: JSON.stringify(filtered_list), brand: $('#brand_name').val()},

                success: function (json) {
                    if (json.content['result']) {
                        console.log('refreshed content');
                        $('#product-content').append(json.content['rendered']);
                        filtered_list['clear'] = 'c0';
                    } else {
                        console.log('Fail to filter');
                    }
                }
            });
        }

        $('#checklist').html(checklist);

        $.typeahead({
            input: '.brand-typeahead',
            order: "desc",
            source: {
                data: brandList


            },

            callback: {
                onInit: function (node) {
                    console.log('Typeahead Initiated on ' + node.selector);
                }

            },

        });


    </script>

{% endblock %}